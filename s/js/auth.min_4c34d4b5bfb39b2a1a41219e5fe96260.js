window.wh=function(){function D(){var a={};return{setItem:function(b,c){a[b]=String(c)},getItem:function(b){return a.hasOwnProperty(b)?a[b]:null},removeItem:function(b){delete a[b]},clear:function(){a={}}}}function J(a){try{var b="undefined"==typeof window?null:window[a];if(null==b)return D();b.setItem("__storejs__test__","__storejs__test__");var c="__storejs__test__"===b.getItem("__storejs__test__");b.removeItem("__storejs__test__");return c?b:D()}catch(d){if(d instanceof DOMException)return D();
throw d;}}function V(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function f(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?\x26]"+a+"\x3d([^\x26#]*)")).exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}function K(a,b,c){var d="";c&&(d=new Date,d.setTime(d.getTime()+864E5*c),d="; expires\x3d"+d.toUTCString());document.cookie=a+"\x3d"+b+d+"; path\x3d/"}
function L(a){a+="\x3d";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function y(){e.removeItem("whVT");e.removeItem("whVID")}function E(a){var b=0,c,d;if(0===a.length)return b;for(c=0;c<a.length;c++)d=a.charCodeAt(c),b=(b<<5)-b+d,b|=0;return b}function M(a){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}
function z(a){a.body["return-to-url"]?e.setItem("whReturnTo",a.body["return-to-url"]):a.body["shared-item-slug"]&&e.setItem("whReturnTo","/"+a.body["shared-item-slug"])}function h(a,b,c){var d=new XMLHttpRequest;d.withCredentials=!0;d.onloadend=function(){if(c){var a;try{a=JSON.parse(d.responseText)}catch(b){console.error("Error parsing API response",b),a=d.responseText}c({status:d.status,body:a})}};d.open("POST",a,!0);d.setRequestHeader("Accept","application/json");if(b.headers)for(var g in b.headers)d.setRequestHeader(g,
b.headers[g]);b.body&&(d.setRequestHeader("Content-Type","application/json; charset\x3dUTF-8"),d.send(JSON.stringify(b.body)))}function F(a){a.onblur=function(a){a.target.classList.toggle("filled",""!==a.target.value.trim())}}function A(a,b){if(window.plausible||window.zaraz){var c=b?b.callback:void 0;if(c&&b.timeout){var d=!1,c=function(){d||(d=!0,b.callback())};setTimeout(c,b.timeout)}window.plausible&&plausible(a,{props:b?b.props:void 0,callback:window.zaraz?void 0:c});window.zaraz&&zaraz.track(a,
{props:b?b.props:void 0}).then(c)}else b&&b.callback&&b.callback()}function v(a){a!=k&&(k=a,e.setItem("whUserId",k))}function G(){k||(k=e.getItem("whUserId"))||v(V());return k}function w(){return null!=L("whil")}function H(){var a;a:{try{var b=e.getItem("whPV");if(b){a=JSON.parse(b)||[];break a}}catch(c){console.error("whPV is invalid",c),e.removeItem("whPV")}a=[]}return{clicked:e.getItem("whAttrClicked"),referrer:e.getItem("whAttrReferrer"),"landing-page":e.getItem("whAttrLanding"),ref:e.getItem("whAttrRef"),
"utm-source":e.getItem("whAttrSource"),"utm-medium":e.getItem("whAttrMedium"),"utm-term":e.getItem("whAttrTerm"),"utm-content":e.getItem("whAttrContent"),"utm-campaign":e.getItem("whAttrCampaign"),gclid:e.getItem("whAttrGclid"),"web-version":L("X_wersion"),pageviews:a,"last-page":(a[a.length-1]||{}).page}}function u(a){a.body["workspace-id"]&&e.setItem("whWID",a.body["workspace-id"])}function m(a){a.body["show-select-email-modal?"]&&e.setItem("whShowEmailSelectModal","true")}function B(a,b){Array.from(document.querySelectorAll(a)).forEach(b)}
function N(a,b){B(a+" .notice",function(a){a.innerHTML=b;a.style.display=""})}function O(a){B(a+" .notice",function(a){a.style.display="none";a.innerHTML=""})}function q(a,b){O(a);B(a+" .error",function(a){a.innerHTML=b;a.style.display=""})}function r(a){O(a);B(a+" .error",function(a){a.style.display="none";a.innerHTML=""})}function n(a,b){if(400!=b.status&&401!=b.status&&418!=b.status&&429!=b.status||!b.body.message)429==b.status?q(a,"Sorry, there's a technical issue. Please try again in a couple of minutes."):
403==b.status&&"compliance-banned"==b.body.reason?q(a,"Access to Whimsical is restricted in your region."):403==b.status&&"banned"==b.body.reason?q(a,"Sorry, you can't access your Whimsical account right now."):q(a,"Sorry, there's a technical issue. We're on it.");else if(q(a,b.body.message),b.body.field){var c=document.querySelector(a+" input."+b.body.field);c.select();c.focus()}}function P(a){var b=document.querySelector(a+".success");b.style.display="";b=document.querySelector(a+".main");b.style.display=
"none"}function Q(){var a=f("return-to");a:{if(a&&window.URL&&(a=new URL(a),window.location.origin===a.origin)){a=a.pathname+a.search+a.hash;break a}a=null}a&&e.setItem("whReturnTo",a);return a}function R(a){var b=document.querySelector(a);":session-limit"==e.getItem("whLoR")&&(N(a,"You’ve been logged out due to reaching the maximum number of active sessions for your account. \x3ca href\x3d'https://help.whimsical.com/article/739-user-session-limit' target\x3d'_blank'\x3eLearn more\x3c/a\x3e"),e.removeItem("whLoR"));
a=b.elements.email;var c=b.elements.password;b.querySelector("button[type\x3dsubmit]").disabled=!1;t?(a.value=t,c.focus()):a.focus();[a,c].forEach(F)}function W(){var a,b=document.querySelector(".signup__social-proof__slides ul"),c=Array.from(document.querySelectorAll(".signup__social-proof__slide-nav button")),d=Array.from(b.querySelectorAll(".signup__social-proof__slide__inner")),g=function(a){c.forEach(function(b,c){b.classList.toggle("-active",c===a)});b.style.transform="translateX(-"+100*a+"vw)"},
e=function(){var b=c.find(function(a){return a.classList.contains("-active")}),b=c.indexOf(b);g(b===c.length-1?0:b+1);window.clearTimeout(a);a=window.setTimeout(e,7500)};c.forEach(function(b,c){b.addEventListener("click",function(){g(c);window.clearTimeout(a)})});d.forEach(function(b){b.addEventListener("click",function(){e();window.clearTimeout(a)})});a=window.setTimeout(e,7500)}function S(a){a=document.querySelector(a).querySelector(".signup__screen-container");a.classList.remove("-show-screen-2");
a.classList.add("-show-screen-1")}function T(a){a?window.location=a:window.location.pathname="/a"}function p(){var a=e.getItem("whReturnTo");a&&e.removeItem("whReturnTo");if("t"!=f("tsl")){e.setItem("whAS",(parseInt(e.getItem("whAS"))||0)+1);try{window.opener.location.href&&window.close()}catch(c){}}var b;G()===x.getItem(X)&&(b=x.getItem(C));x.removeItem(C);window.location=a||b||"/"}function U(){if(w()){var a=x.getItem(C);a&&(window.location.href=a,x.removeItem(C))}else window.setTimeout(U,5E3)}function Y(){var a=
document.location;-1!=a.search.indexOf("utm_")&&history.replaceState&&history.replaceState({},"",a.href.replace(/(\&|\?)utm([_a-z0-9=]+)/g,""))}function Z(a){!a&&e.getItem("whVisited")||h("/api/account.visit",{body:{"user-id":G(),attr:H()}},function(a){200==a.status&&e.setItem("whVisited",!0)})}function aa(){var a=f("ref"),b=f("gclid");if((b=!(!a&&!b))||!e.getItem("whAttrReferrer")){var c=function(){function b(a,c){c?e.setItem(a,c):e.removeItem(a)}b("whAttrClicked",(new Date).toISOString());b("whAttrReferrer",
d);b("whAttrLanding",document.location.href);b("whAttrRef",a);b("whAttrSource",f("utm_source"));b("whAttrMedium",f("utm_medium"));b("whAttrTerm",f("utm_term"));b("whAttrContent",f("utm_content"));b("whAttrCampaign",f("utm_campaign"));b("whAttrGclid",f("gclid"))},d=document.referrer;b&&!w()?c():d?d.match(/(http|https):\/\/[\w\.]*whimsical.com.*/i)||d.match(/(http|https):\/\/[\w\.]*whimsical.co.*/i)||d.match(/https:\/\/accounts\.google\.com\.*/i)||c():e.getItem("whAttrLanding")||c();Z(b)}Y()}var e=
J("localStorage"),x=J("sessionStorage"),l,t,k,C="whLastUrl",X="whLastUserId";return{init:function(a){l=a;(a=f("invite"))&&K("whir",a,365);w()||U();aa()},loginInit:R,login:function(a,b,c){c=void 0===c?p:c;a.preventDefault();r(b);a=document.querySelector(b);var d=a.elements.email.value,g=a.elements.password.value,f=a.querySelector("button[type\x3dsubmit]");f.disabled||(f.disabled=!0,h("/api/account.login",{body:{email:d,password:g,"client-id":l.CID},headers:{x:E(d.toLowerCase()+g)}},function(a){200==
a.status?(y(),v(a.body["user-id"]),z(a),a.body["workspace-id"]&&e.setItem("whWID",a.body["workspace-id"]),A("signin",{props:{type:"email"},callback:function(){a.body.activated?(m(a),u(a),c()):window.location="/mfa-required"},timeout:1E3})):(f.disabled=!1,n(b,a))}))},signupInit:function(a){function b(){var a=!0;0!==g.value.length&&M(g.value)?g.classList.remove("inv"):(a=!1,g.classList.add("inv"));0==d.value.length?(a=!1,d.classList.add("inv")):d.classList.remove("inv");12>e.value.length||64<e.value.length?
(a=!1,e.classList.add("inv"),0<e.value.length?c.querySelector(".password .input-hint").classList.add("show"):c.querySelector(".password .input-hint").classList.remove("show")):(e.classList.remove("inv"),c.querySelector(".password .input-hint").classList.remove("show"));!1===I.checked&&(a=!1);h.disabled=!a}W();var c=document.querySelector(a),d=c.elements.name,g=c.elements.email,e=c.elements.password,h=c.querySelector("button[type\x3dsubmit]"),I=c.elements["accept-tos"],m=[d,g,e,I],n=c.querySelector(".signup__continue-btn"),
p=c.querySelector(".signup__back-btn"),l=c.querySelector(".signup__screen-container"),k=function(){0!==g.value.length&&M(g.value)?(r(a),l.classList.remove("-show-screen-1"),l.classList.add("-show-screen-2"),d.focus()):q(a,"Enter a valid email address")};n.addEventListener("click",k);g.addEventListener("keyup",function(a){a.key&&"enter"===a.key.toLowerCase()&&k()});p.addEventListener("click",function(){return S(a)});"lenny"===f("ref")&&N(a,'\x3cimg src\x3d"/s/images/tada-icon.svg" alt\x3d"" /\x3e Sign up for 20% off our Pro plan — Special for Lenny\'s listeners!');
t&&(g.value=t);m.forEach(function(a){a.oninput=b;F(a)});I.onClick=b},signup:function(a,b){a.preventDefault();var c=document.querySelector(b),d=c.elements.name.value,e=c.elements.email.value,f=c.elements.password.value,k=c.querySelector("button[type\x3dsubmit]");k.disabled||(k.disabled=!0,r(b),h("/api/account.register",{body:{name:d,email:e,password:f,attr:H(),"client-id":l.CID},headers:{x:E(e.toLowerCase()+f)}},function(a){200==a.status?(y(),v(a.body["user-id"]),m(a),z(a),A("signup",{props:{type:"email"},
callback:p,timeout:1E3})):(k.disabled=!1,n(b,a),a.body.message&&a.body.message.match(/password/i)||S(b))}))},startGoogleLogin:function(a){h("/api/account.google.create-auth-url",{body:{"client-id":l.CID,"user-id":G()}},function(b){200==b.status?window.location=b.body:n(a,b)})},finishGoogleLogin:function(){var a=f("code"),b=f("state");history.replaceState({},"",location.href.replace(/\?.*/g,""));a?h("/api/account.google.login",{body:{"client-id":l.CID,code:a,state:b,attr:H()}},function(a){if(200==
a.status)if(a.body["two-step?"]){e.setItem("whTSK",a.body["two-step-key"]);t=a.body.email;document.querySelector(".account").style.display="";a=document.getElementsByClassName("sso-two-step-info-email");for(var b=0;b<a.length;b++)a[b].innerHTML=t;R("#login-email")}else y(),v(a.body["user-id"]),m(a),u(a),z(a),A(a.body["new"]?"signup":"signin",{props:{type:"google"},callback:p(),timeout:1E3});else window.location="/login"}):window.location="/login"},completeGoogleTwoStepLogin:function(a,b){b=!!b;a&&
a.preventDefault();document.querySelector(".two-step-login-fail").style.display="none";h("/api/account.google.two-step-login",{body:{"two-step-key":e.getItem("whTSK"),"reset-password?":b}},function(a){200==a.status?b?(document.querySelector(".two-step-login-google").style.display="none",document.querySelector(".two-step-login-fail").style.display="none",document.querySelector(".two-step-login-password-reset-success").style.display=""):(y(),v(a.body["user-id"]),m(a),u(a),z(a),p()):(document.querySelector(".two-step-login-google").style.display=
"none",document.querySelector(".two-step-login-fail").style.display="",q("#two-step-login-fail",a.body))})},sendResetPassword:function(a,b){a.preventDefault();r(b);var c=document.querySelector(b+".main"),d=c.elements.email.value,e=c.elements.submit;e.disabled||(e.setAttribute("disabled","disabled"),h("/api/account.send-reset-password",{body:{email:d,"client-id":l.CID},headers:{x:E(d.toLowerCase())}},function(a){200==a.status?P(b):(n(b,a),e.removeAttribute("disabled"))}))},forgotPasswordInit:function(a){a=
document.querySelector(a+".main");F(a.elements.email)},resetPassword:function(a,b){a.preventDefault();r(b);var c=document.querySelector(b+".main").elements.password.value,d=window.location.pathname.split("/")[2];h("/api/account.reset-password",{body:{"reset-id":d,"client-id":l.CID,password:c}},function(a){200==a.status?P(b):"request-again"==a.body.field?(a=document.querySelector(b+".main"),a.style.display="none",a=document.querySelector(b+".expired"),a.style.display=""):n(b,a)})},verifyTokenMfa:function(a,
b){a.preventDefault();r(b);var c=document.querySelector(b+".main"),d=c.elements.submit;d.disabled||(d.disabled=!0,h("/api/account.verify-token-mfa",{body:{"mfa-token":parseInt(c.elements["mfa-token"].value)}},function(a){200==a.status?(m(a),u(a),p()):(d.disabled=!1,n(b,a))}))},recoverTokenMfa:function(a,b){a.preventDefault();r(b);var c=document.querySelector(b+".main"),d=c.elements.submit;d.disabled||(d.disabled=!0,c=c.elements["mfa-recovery-code"].value.toLowerCase(),h("/api/account.verify-token-mfa",
{body:{"mfa-recovery-code":c}},function(a){200==a.status?(m(a),u(a),e.setItem("whReturnTo","/account"),p()):(d.disabled=!1,n(b,a))}))},mfaRequiredValidate:function(a){a=document.querySelector(a+".main");var b=a.elements.submit;/^[0-9]{1,6}$/.test(a.elements["mfa-token"].value)?b.disabled=!1:b.disabled=!0},mfaRecoveryValidate:function(a){var b=document.querySelector(a+".main");a=b.elements["mfa-recovery-code"];b=b.elements.submit;console.log(a.value);/^[a-z2-7]{16}$/.test(a.value)?b.disabled=!1:b.disabled=
!0},logout:function(a){h("/api/account.logout",{body:{}},function(a){window.location="/login"})},loadApp:T,loadAppIfLoggedIn:function(a){w()&&!f("r")&&T(a)},validateCookies:function(a){h("/api/account.validate-cookies",{body:{}},function(b){200==b.status?p():a()})},saveReturnTo:Q,saveAuthContext:function(){var a=Q(),b=f("e");b&&(t=b);(a||b)&&history.replaceState({},"",location.href.replace(/\?.*/g,""))},joinWorkspace:function(){var a=window.location.pathname.split("/")[2];if(w())h("/api/workspace.join",
{body:{"invite-code":a}},function(a){200==a.status?(m(a),u(a),window.location=a.body["shared-item-slug"]?"/"+a.body["shared-item-slug"]:"/a"):document.querySelector("#join-error").style.display=""});else{var b="/signup",c=f("e");c&&(b+="?e\x3d"+encodeURIComponent(c));K("whic",a,1/24);window.location=b}},flip:function(a,b){var c=document.querySelector(a);c.style.display="none";c=document.querySelector(b);c.style.display=""},trackEvent:A}}();